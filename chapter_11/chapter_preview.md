# Тестирование и профилирование кода
## Кратное содержание
### Основные термины
* Оптимизация - устранение узких мест, которые влияют на производительность
* Тестирование - проверка, делает ли ваш код то, что задумывалось
* Профилирование - измерение некоторых аспектов программы с целью понимания как работает код
* Бенчмаркинг - измерение производительности функции или программы
### General
* Оптимизацией следует заниматься только после проверки кода на корректность, а не во время написание кода (преждевременная оптимизация)
* Инога профилирование стоит выполнять на более медленном железе (а не на реальном), чтобы видеть узкие места
* Бенчмаркингом следует заниматься на незагруженной машине, для избежания неточных результатов
### Test
* Имя тестовой функции должно соответствовать Test[A-Z].*|Test_.*
* Имя файла содержащего тестовые функции должно заканчиваться на _test.go
* Запуск тестов с помощью команды go test
* флаг -v для более полного вывода
* флаг -cover для отображения процента покрытия
* флаг -shuffle для перетасовки порядока выполнения (go test -shuffle=on)
* Для тестирования функции main можно использовать сделующий метод (см example_test_main)
### Benchmark
* Имя функции бенчмарка должно соответствовать Benchmark[A-Z].*|Benchmark_.*
* Имя файла содержащего функции бенчмарка должно заканчиваться на _test.go
* Запуск табличного бенчмарка - команда go test -bench=. . (см example_table_bench)
* Если функция бенчмарка выполняется за время менее 1 секунды, то b.N (*testing.B.N) растет и функция выполняется заново. Это нужно для усреднения результатов более быстрых функций.
* b.N (*testing.B.N) - нужно быть осторожными при использовании в циклах и параметрах функции одновременно
* При бенчмарке нужно обращать внимание на оптимизацию компилятора, который может просто выкинуть весь наш проверяемый код, как неиспользуемый. Для этого можно например присвоить результат выполнения функции к глобальной переменной вконце бенчмарка
* Метод b.Run(), который позволяет запускать один или несколько субтестов в рамках бенчмарк-функции
* Столбцы - имя | количество выполнений | среднее время выполнения
* -benchmem добавляет 2 стобца - объем выделенной памяти в среднем на выполнение | количество аллокаций в среднем на выполнение 
### Benchstat
* Утилита для сравнения двух бенчмарков
### Профилирование
* Профилирование — это процесс динамического анализа программы, который
измеряет различные значения, связанные с выполнением программы, что
позволяет вам лучше понять ее поведение
* Стандартный Go-пакет runtime/pprof служит для профилирования всех видов
приложений, кроме HTTP-серверов
* Стандартный Go-пакет net/http/pprof служит для профилирования HTTP-серверов
* go tool pprof -help справка
* Запустить программу example_profile
* go tool pprof ./cpuProfileCla.out
* top - отображение 10ти "лучших" записей
* list main.N2 - информация о функции main.N2
### Профилирование HTTP

### Ссылки на литературу
* Compilers: Principles, Techniques and Tools Альфреда В. Ахо, Моники С. Лам, Рави Сети и Джеффри Д. Ульмана
